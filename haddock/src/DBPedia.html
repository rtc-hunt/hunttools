<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>DBPedia.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE Trustworthy #-}</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-comment'>{-| 
<a name="line-4"></a> Module: DBPedia
<a name="line-5"></a> Description: SPARQL queries against DBPedia, a structured extract of Wikipedia.
<a name="line-6"></a>-}</span>
<a name="line-7"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>DBPedia</span> <span class='hs-layout'>(</span><span class='hs-varid'>runDBPedia</span><span class='hs-layout'>,</span> <span class='hs-varid'>defaultDBPQuery</span><span class='hs-layout'>)</span>
<a name="line-8"></a><span class='hs-keyword'>where</span>
<a name="line-9"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Network</span><span class='hs-varop'>.</span><span class='hs-conid'>HTTP</span>
<a name="line-10"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>IO</span><span class='hs-varop'>.</span><span class='hs-conid'>Unsafe</span>
<a name="line-11"></a>
<a name="line-12"></a><a name="preamble"></a><span class='hs-definition'>preamble</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>urlEncode</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unlines</span> <span class='hs-keyglyph'>[</span>
<a name="line-13"></a>  <span class='hs-str'>"prefix ont: &lt;http://dbpedia.org/ontology/&gt;"</span><span class='hs-layout'>,</span>
<a name="line-14"></a>  <span class='hs-str'>"prefix res: &lt;http://dbpedia.org/resource/&gt;"</span><span class='hs-layout'>,</span>
<a name="line-15"></a>  <span class='hs-str'>"prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;"</span><span class='hs-layout'>,</span>
<a name="line-16"></a>  <span class='hs-str'>"prefix rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;"</span><span class='hs-layout'>,</span>
<a name="line-17"></a>  <span class='hs-str'>""</span><span class='hs-keyglyph'>]</span>
<a name="line-18"></a><a name="defaultDBPQuery"></a><span class='hs-definition'>defaultDBPQuery</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unlines</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"select distinct ?c where {"</span><span class='hs-layout'>,</span>
<a name="line-19"></a>  <span class='hs-str'>"?a ont:kingdom res:Animal"</span><span class='hs-layout'>,</span>
<a name="line-20"></a>  <span class='hs-str'>". ?a rdf:label ?c"</span><span class='hs-layout'>,</span>
<a name="line-21"></a>  <span class='hs-str'>"FILTER regex(str(?c), \"^.a....$\")"</span><span class='hs-layout'>,</span>
<a name="line-22"></a>  <span class='hs-str'>"FILTER langMatches(lang(?c), \"en\")"</span><span class='hs-layout'>,</span>
<a name="line-23"></a>  <span class='hs-str'>"}"</span><span class='hs-keyglyph'>]</span>
<a name="line-24"></a><a name="postamble"></a><span class='hs-definition'>postamble</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>urlEncode</span> <span class='hs-str'>" "</span>
<a name="line-25"></a>
<a name="line-26"></a>
<a name="line-27"></a>
<a name="line-28"></a><a name="queryToURL"></a><span class='hs-definition'>queryToURL</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span> <span class='hs-layout'>(</span><span class='hs-str'>"http://dbpedia.org/sparql?default-graph-uri=http%3A%2F%2Fdbpedia.org&amp;query="</span> <span class='hs-varop'>++</span> <span class='hs-varid'>preamble</span><span class='hs-layout'>)</span> <span class='hs-varop'>++</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-varop'>++</span> <span class='hs-layout'>(</span><span class='hs-varid'>postamble</span> <span class='hs-varop'>++</span> <span class='hs-str'>"&amp;format=text%2Ftab-separated-values&amp;CXML_redir_for_subjs=121&amp;CXML_redir_for_hrefs=&amp;timeout=30000&amp;debug=on"</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>urlEncode</span>
<a name="line-29"></a>
<a name="line-30"></a>
<a name="line-31"></a><a name="runDBPedia"></a><span class='hs-definition'>runDBPedia</span> <span class='hs-varid'>query</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unsafePerformIO</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span> 
<a name="line-32"></a>        <span class='hs-varid'>rv</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>simpleHTTP</span> <span class='hs-varop'>$</span> <span class='hs-varid'>getRequest</span> <span class='hs-varop'>$</span> <span class='hs-varid'>queryToURL</span> <span class='hs-varid'>query</span>
<a name="line-33"></a>        <span class='hs-varid'>rb</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getResponseBody</span> <span class='hs-varid'>rv</span>
<a name="line-34"></a>        <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>tail</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lines</span> <span class='hs-varop'>$</span> <span class='hs-varid'>filter</span> <span class='hs-layout'>(</span><span class='hs-varop'>/=</span> <span class='hs-chr'>'"'</span><span class='hs-layout'>)</span> <span class='hs-varid'>rb</span>
<a name="line-35"></a>
</pre></body>
</html>
