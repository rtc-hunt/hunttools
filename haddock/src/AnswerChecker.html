<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>AnswerChecker.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE Trustworthy #-}</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-comment'>{-|
<a name="line-4"></a>Module: AnswerChecker
<a name="line-5"></a>Description: Check answers for puzzlehunt 2016 - Monsters et Manus - without seeing them.
<a name="line-6"></a> -}</span>
<a name="line-7"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>AnswerChecker</span> <span class='hs-layout'>(</span> 
<a name="line-8"></a>        <span class='hs-varid'>checkAnswer</span><span class='hs-layout'>,</span>
<a name="line-9"></a>        <span class='hs-varid'>checkAnswerFuzzy</span><span class='hs-layout'>,</span>
<a name="line-10"></a>        <span class='hs-conid'>Correctness</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-11"></a><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-12"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Network</span><span class='hs-varop'>.</span><span class='hs-conid'>Wreq</span>
<a name="line-13"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>Regex</span><span class='hs-varop'>.</span><span class='hs-conid'>TDFA</span>
<a name="line-14"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Lens</span>
<a name="line-15"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span><span class='hs-varop'>.</span><span class='hs-conid'>Lazy</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteString</span><span class='hs-layout'>)</span>
<a name="line-16"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>List</span>
<a name="line-17"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Char</span>
<a name="line-18"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>IO</span><span class='hs-varop'>.</span><span class='hs-conid'>Unsafe</span>
<a name="line-19"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Exception</span>
<a name="line-20"></a>
<a name="line-21"></a><a name="replace"></a><span class='hs-definition'>replace</span> <span class='hs-varid'>s</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>-&gt;</span><span class='hs-keyword'>if</span> <span class='hs-varid'>s</span><span class='hs-varop'>==</span><span class='hs-varid'>a</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>d</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-22"></a>
<a name="line-23"></a><a name="Correctness"></a><span class='hs-comment'>-- | Simple "are you correct?" type, with a 'Show' instance.</span>
<a name="line-24"></a><a name="Correctness"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Correctness</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CORRECT</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>INCORRECT</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NONEXISTANT</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
<a name="line-25"></a><a name="toCorrectness"></a><span class='hs-definition'>toCorrectness</span> <span class='hs-conid'>True</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CORRECT</span>
<a name="line-26"></a><span class='hs-definition'>toCorrectness</span> <span class='hs-conid'>False</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>INCORRECT</span>
<a name="line-27"></a><a name="exToCorr"></a><span class='hs-definition'>exToCorr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SomeException</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Correctness</span>
<a name="line-28"></a><span class='hs-definition'>exToCorr</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NONEXISTANT</span>
<a name="line-29"></a>
<a name="line-30"></a><a name="checkAnswer"></a><span class='hs-comment'>-- | Check an answer, assuming that it follows /exactly/ the puzzle-solution CSS class and uppercase pattern.</span>
<a name="line-31"></a><span class='hs-definition'>checkAnswer</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Correctness</span>
<a name="line-32"></a><span class='hs-definition'>checkAnswer</span> <span class='hs-varid'>puzzle</span> <span class='hs-varid'>answer</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unsafePerformIO</span> <span class='hs-varop'>$</span>
<a name="line-33"></a>  <span class='hs-varid'>handle</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varid'>exToCorr</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>toCorrectness</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varop'>=~</span> <span class='hs-layout'>(</span><span class='hs-str'>"&lt;span class=\"puzzle-solution\"&gt;"</span><span class='hs-varop'>++</span><span class='hs-layout'>(</span><span class='hs-varid'>toUpper</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>answer</span><span class='hs-layout'>)</span><span class='hs-varop'>++</span><span class='hs-str'>"&lt;/span&gt;"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-34"></a>    <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>view</span> <span class='hs-varid'>responseBody</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>get</span> <span class='hs-varop'>$</span> <span class='hs-str'>"http://solutions.monsters-et-manus.com/hunt/solution/"</span> <span class='hs-varop'>++</span><span class='hs-layout'>(</span><span class='hs-varid'>replace</span> <span class='hs-chr'>' '</span> <span class='hs-chr'>'_'</span> <span class='hs-varop'>$</span> <span class='hs-varid'>toLower</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>puzzle</span><span class='hs-layout'>)</span><span class='hs-varop'>++</span> <span class='hs-str'>".html"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> 
<a name="line-35"></a>
<a name="line-36"></a><a name="checkAnswerFuzzy"></a><span class='hs-comment'>-- | Pattern match against the given answer, in uppercase, on it's own within any pair of HTML tags. Can leak answer information, use only if confident and 'checkAnswer' doesn't work.</span>
<a name="line-37"></a><span class='hs-definition'>checkAnswerFuzzy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteString</span>
<a name="line-38"></a><span class='hs-definition'>checkAnswerFuzzy</span> <span class='hs-varid'>puzzle</span> <span class='hs-varid'>answer</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>=~</span> <span class='hs-layout'>(</span><span class='hs-str'>"&lt;[^&gt;]*&gt;"</span><span class='hs-varop'>++</span><span class='hs-layout'>(</span><span class='hs-varid'>toUpper</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>answer</span><span class='hs-layout'>)</span><span class='hs-varop'>++</span><span class='hs-str'>"&lt;/[^&gt;]*&gt;"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>view</span> <span class='hs-varid'>responseBody</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unsafePerformIO</span> <span class='hs-layout'>(</span><span class='hs-varid'>get</span> <span class='hs-varop'>$</span> <span class='hs-str'>"http://solutions.monsters-et-manus.com/hunt/solution/"</span> <span class='hs-varop'>++</span><span class='hs-layout'>(</span><span class='hs-varid'>replace</span> <span class='hs-chr'>' '</span> <span class='hs-chr'>'_'</span> <span class='hs-varop'>$</span> <span class='hs-varid'>toLower</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>puzzle</span><span class='hs-layout'>)</span><span class='hs-varop'>++</span> <span class='hs-str'>".html"</span><span class='hs-layout'>)</span>
</pre></body>
</html>
